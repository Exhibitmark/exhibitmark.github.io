<html class="dark" lang="">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="icon" href="/favicon.ico">
    <title>GHST Leaderboard</title>
    <link href="./main.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .red {
            color:#e61748;
        }
        .blue {
            color:#6769eb;
        }
        .hidden {
            display:none;
        }

    </style>
</head>

<body class="main">
    <div id="app">
        <div>
            <div class="flex">
                <nav class="side-nav">
                    <a href="/" class="router-link-active intro-x flex items-center pl-5 pt-4">
                        <img style="width:4rem" src="./logo.png">
                    </a>
                    <div class="side-nav__devider my-6"></div>
                    <ul>
                        <li>
                            <a href="./speedruns.html" style="background-color:#e8e8e8 ;" class="side-menu">
                                <div class="side-menu__icon"></div>
                                <div style="color:#6769eb; font-weight:600" class="side-menu__title">Leaderboard</div>
                            </a>
                        </li>
                        <li>
                            <a href="./speedrun_submit.html" class="side-menu">
                                <div class="side-menu__title">Submit Run</div>
                            </a>
                        </li>
                        <li>
                            <a href="./rules.html" class="side-menu">
                                <div class="side-menu__title">Rules</div>
                            </a>
                        </li>
                        
                    </ul>
                </nav>
                <div class="content">
                    <!--TOP BAR COMMENTED OUT-->
                    <!--<div class="top-bar"></div>-->
                    <!--MAIN CONTENT-->
                    <div>
                        <div class="intro-y col-span-12 flex flex-wrap sm:flex-nowrap items-center mt-2">
                            <svg style="cursor:pointer; overflow:visible; margin-top:2rem" id="back" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left mr-5" viewBox="0 0 10 10">
                                <path fill-rule="evenodd" stroke-width="3" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/>
                            </svg>

                            <h2 id="leaderboard_title" class="intro-y text-lg font-medium mt-10">Leaderboard</h2>
                            <div class="w-full sm:w-auto mt-3 sm:mt-0 sm:ml-auto md:ml-0">
                                <div style="display:flex" class="w-56 relative text-gray-700 dark:text-gray-300 justify-end">
                                    <h3 id="status" class="intro-y text-sm font-medium mt-10 red">Server Loading</h3>
                                </div>
                            </div>
                        </div>
                        <div class="grid grid-cols-12 gap-6 mt-5">
                            <div class="intro-y col-span-12 overflow-auto lg:overflow-visible">
                                <table class="table table-report -mt-2">
                                    <thead>
                                        <tr id="table_header">
                                            <th class="whitespace-nowrap">Map</th>
                                            <th class="whitespace-nowrap">Map Author</th>
                                            <th class="text-center whitespace-nowrap">Record Holder</th>
                                            <th class="text-center whitespace-nowrap">Time</th>
                                            <th class="text-center whitespace-nowrap">Record Run</th>
                                        </tr>
                                    </thead>
                                    <tbody id="table_body">
                                        <!--
                                        <tr class="intro-x">
                                            <td class="w-40">
                                                <a href="" class="font-medium whitespace-nowrap">PA Levels v2</a>
                                            </td>
                                            <td>
                                                <div href="" class="font-medium whitespace-nowrap">Joshington</div>
                                                <div class="text-gray-600 text-xs whitespace-nowrap mt-0.5">snappy8516</div>
                                            </td>
                                            <td class="text-center">ðŸ‘‘ aKidNamedMark</td>
                                            <td class="w-40">
                                                <div class="flex items-center justify-center">00:01:23.24</div>
                                            </td>
                                            <td class=" w-56">
                                                <div class="flex justify-center items-center">
                                                    <a href="" style="color:#6769eb;" class="font-medium whitespace-nowrap">Video</a>
                                                </div>
                                            </td>
                                        </tr>-->
                                    </tbody>
                                </table>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        get(`https://acute-ginger-appeal.glitch.me/runs`, build)

        function view_map(data){
            $( "#table_body" ).empty();
        }

        function table_click(e){
            console.log(e)
        }

        $('#back').click(function(e){
            get(`https://acute-ginger-appeal.glitch.me/runs`, build)
        })

        //For the high level leaderboard elements
        function tableElement(data){
            if(data.records[0] == undefined){
                data.records.push({
                    "gamertag":"No Records",
                    "time":"00:00:00.00"
                })
            }
            return `<tr class="intro-x">
                    <td class="w-40 table_item">
                        <div style="cursor:pointer;" id=${data.id} class="font-medium whitespace-nowrap">${data.name}</div>
                    </td>
                    <td>
                        <div href="" class="font-medium whitespace-nowrap tooltip">${data.author}</div>
                        <div class="text-gray-600 text-xs whitespace-nowrap mt-0.5">${data.fileshare}</div>
                    </td>
                    <td class="text-center">ðŸ‘‘ ${data.records[0].gamertag}</td>
                    <td class="w-40">
                        <div class="flex items-center justify-center">${data.record_time}</div>
                    </td>
                    <td class=" w-56">
                        <div class="flex justify-center items-center">
                            <a href="${data.link}" style="color:#6769eb;" class="font-medium whitespace-nowrap">Video</a>
                        </div>
                    </td>
                </tr>`
        }
         
        //For the individual run elements
        function recordItem(data,index){
            let full_date = new Date(Date.parse(data.time_submitted)).toString()
            if(index == 0){
                data.gamertag = "ðŸ‘‘ " + data.gamertag
            }
            return `<tr class="intro-x">
                <td>
                    <div href="" class="font-medium whitespace-nowrap">${data.gamertag}</div>
                    <div class="text-gray-600 text-xs whitespace-nowrap mt-0.5">${ordinal_suffix_of(index+1)} place</div>
                </td>
                <td class="w-40">
                    <div class="flex items-center justify-center">${msToTime(data.time)}</div>
                </td>
                <td class="w-56">
                    <div class="flex items-center justify-center">
                        <a href="https://www.youtube.com/watch?v=${data.link}" style="color:#6769eb;" class="font-medium whitespace-nowrap">Video</a>
                    </div>
                </td>
                <td class="items-center justify-center" >${full_date.slice(0,full_date.lastIndexOf(":")+3)}</td>
            </tr>`
        }
        // For the individual map table headers
        function mapTableHeader(){
            return `
                <th class="whitespace-nowrap">Record Holder</th>
                <th class="text-center whitespace-nowrap">Time</th>
                <th class="text-center whitespace-nowrap">Video</th>
                <th class="text-center whitespace-nowrap">Date</th>`
        }

        // For the leaderboard table headers
        function leaderboardHeader(){
            return `  
            <th class="whitespace-nowrap">Map</th>
            <th class="whitespace-nowrap">Map Author</th>
            <th class="text-center whitespace-nowrap">Record Holder</th>
            <th class="text-center whitespace-nowrap">Time</th>
            <th class="text-center whitespace-nowrap">Record Run</th>`
        }

        function get(url,cb){
            $('#status').removeClass('blue')
            fetch(url)
                .then(response => response.json())
                .then(commits => {
                    $('#status').toggleClass('blue').text('Server Online')
                    cb(commits,url)
                });
        }

        function build(data){
            $('#leaderboard_title').text("Leaderboard")
            $('#back').toggle()
            $( "#table_body" ).empty();
            $("#table_header").empty()
            $( "#table_header" ).prepend(leaderboardHeader()); 
            Object.keys(data).forEach((e, i) => {
                if(data[e].records[0] == undefined){
                    data[e].records.push({
                        "gamertag":"No Records",
                        "time":"00:00:00.00"
                    })
                }
               e.record = data[e].records[0].gamertag
               $( "#table_body" ).append(tableElement(data[e])); 
            });

            let elements = document.getElementsByClassName("table_item");

            for (var i = 0; i < elements.length; i++) {
                elements[i].addEventListener("click", function(e){
                    get(`https://acute-ginger-appeal.glitch.me/maps?map=${e.originalTarget.id}`,build_map)
                }); 
            }
        }

        function build_map(data, url){
            let d = data.records
            $('#back').toggle()
            $('#leaderboard_title').text(data.name + " Leaderboard")
            $("#table_header").empty();
            $( "#table_body" ).empty();
            
            $( "#table_header" ).prepend(mapTableHeader()); 
            Object.keys(d).forEach((e, i) => {
                $( "#table_body" ).append(recordItem(d[e],i)); 
            });
        }

        function msToTime(s) {
            // Pad to 2 or 3 digits, default is 2
            function pad(n, z) {
            z = z || 2;
            return ('00' + n).slice(-z);
            }

            var ms = s % 1000;
            s = (s - ms) / 1000;
            var secs = s % 60;
            s = (s - secs) / 60;
            var mins = s % 60;
            var hrs = (s - mins) / 60;

            return pad(hrs) + ':' + pad(mins) + ':' + pad(secs) + '.' + pad(ms, 2);
        }

        function ordinal_suffix_of(i) {
            var j = i % 10,
                k = i % 100;
            if (j == 1 && k != 11) {
                return i + "st";
            }
            if (j == 2 && k != 12) {
                return i + "nd";
            }
            if (j == 3 && k != 13) {
                return i + "rd";
            }
            return i + "th";
        }
    </script>
</body>
</html>